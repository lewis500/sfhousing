<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link href='http://fonts.googleapis.com/css?family=Fenix' rel='stylesheet' type='text/css'>
<style>
body {
  font-family: Fenix, serif;
  font-size: 14;
}
h4 {
  margin-bottom: 0px;
  text-align: center;
}
#main {
  width: 620px;
}
.axis path, .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
.x.axis path {
  display: none;
}
.line {
  fill: none;
  stroke: steelblue;
  /*stroke-width: 1.5px;*/
}

span{
  font-size: 16px;
  font-weight: bold
}

div.tooltip {
  line-height: 1.3;
  /*text-align: center;*/
  /*font-weight: bold;*/
  /*position: absolute;*/
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border: 0px;
  border-radius: 2px;
  /*opacity: 0.2;*/
  pointer-events: none;
  font-size: 14px;
  /*margin-top: 50px;*/
}
.y line {
  opacity: .8;
  stroke: #d3d3d3;
}
#button {
  position: absolute;
  left: 250px;
  top: 30px;
}
</style>

<link rel="stylesheet" href="style/slider.css">

<script src="http://d3js.org/d3.v3.js"></script>
<script src="scripts/libraries/dimple.js"></script>
<script src="scripts/libraries/underscore.js"></script>



<body>
  <div id="main">
    <button id="button" type="button" onclick="adapt()" class="btn-info btn ">Change Since 1991</button>
    <h4>Growth in San Francisco</h4>
    <div id="chartContainer1"></div>
    <div id="slider"></div>
    <div id="icons"></div>
    <div style="text-align: right">
    <b>Sources:</b><br>
      <a href="http://www.sf-planning.org/ftp/files/publications_reports/2011_Housing_Inventory_Report.pdf">Housing: San Francisco Planning Department</a> <br>
      <a href="http://research.stlouisfed.org/fred2/series/CASANF0POP">Population: Federal Reserve Bank of St. Louis</a> <br>
      <a href="http://www.bls.gov/cew/">Jobs: Bureau of Labor Statistics</a>
    </div>
  </div>


  <div style="opacity:0">

      <svg width="20.88px" height="21.371px" >
        <polygon id="house" fill="#d39651" points="0,10.37 0,10.37 10.439,0 15.261,4.789 15.261,1.661 
        17.746,1.661 17.746,7.258 20.88,10.37 20.88,10.37 17.376,10.37 17.376,21.371 12.191,21.371 12.191,14.995 7.918,14.995 
        7.918,21.371 2.732,21.371 2.732,10.37 " transform="translate(-10,-10)"/>
      </svg>

      <svg width="100px" height="100px">
        <g id="worker">
          <g id="subworker">
            <g  fill="#6b94b0"  transform="scale(0.25) translate(-40,-40) ">
              <path d="M46.902,99C47.524,95.74,48,92.447,48,88.423C48,76.039,44.642,66,40.5,66C36.357,66,33,76.039,33,88.423  c0,3.835,0.333,7.422,0.902,10.577" />
              <path d="M62.229,51.678c1.54,13.452,7.729,23.793,13.825,23.096c6.098-0.698,9.791-12.17,8.25-25.623  c-1.54-13.454-3.73-23.907-9.827-23.209C68.381,26.64,60.689,38.224,62.229,51.678z" />
              <path d="M76.583,27.178c1.485,2.701-4.507,8.94-13.382,13.931c-8.878,4.993-17.278,6.848-18.762,4.146  c-1.486-2.702,4.505-8.939,13.38-13.933C66.697,26.331,75.097,24.477,76.583,27.178z" />
              <ellipse cx="58.667" cy="69.676" rx="22" ry="8.108" />
              <ellipse cx="68.833" cy="12.979" rx="10.833" ry="10.98" />
              <path d="M3,49.241L58.636,49c0,0,3.438,2.889-0.239,7.223C54.719,60.555,3,62,3,62V49.241z" />
              <path d="M37,47c0,0,5-1,3.5-3.985c-0.225-0.447-23.04-1.329-23.04-1.329l-6.882-25.24c0,0-3.435-2.682-4.528,1.328  C4.963,21.76,12.804,47,12.804,47" />
            </g>
          </g>
        </g>
      </svg>

      <svg width="64px" height="64px">
        <g id="people">
          <g id="subpeople" style="fill:#d26b5f;"  transform="scale(0.5) translate(-30,-30)">
            <path d="M12.476,18.525c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217
          c0.003-2.7,0.007-5.401-0.002-8.101c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003
          c-1.463,0.005-2.229,0.771-2.233,2.228c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142
          c0.025,0.585,0.445,0.966,0.988,0.967c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536
          c0-1.83-0.005-3.66,0.01-5.49c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484
          c0.044,0.118,0.009,0.265,0.009,0.399c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529
          c0.804,0.016,1.256-0.528,1.259-1.54c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486
          c0.003-0.182,0.172-0.362,0.263-0.542c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792
          c0,2.991,0.002,5.981-0.002,8.972c-0.001,0.559,0.166,1.09,0.711,1.237c0.399,0.108,0.988,0.084,1.283-0.148
          c0.304-0.239,0.493-0.8,0.496-1.222c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265
          c0.056-0.144,0.146-0.275,0.221-0.412c0.084,0.126,0.219,0.243,0.242,0.379c0.041,0.239,0.016,0.489,0.015,0.734
          C12.476,15.132,12.469,16.828,12.476,18.525z" />
            <path d="M11.235,5.505c0.008-1.112-0.877-2.007-1.983-2.006C8.144,3.5,7.239,4.399,7.246,5.492c0.007,1.07,0.888,1.951,1.961,1.963
          C10.344,7.468,11.227,6.618,11.235,5.505z" />
            <path d="M28.988,10.451c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003
          c-1.463,0.005-2.229,0.771-2.233,2.228c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142
          c0.025,0.585,0.445,0.966,0.988,0.967c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536
          c0-1.83-0.005-3.66,0.01-5.49c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484
          c0.044,0.118,0.009,0.265,0.009,0.399c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529
          c0.804,0.016,1.256-0.528,1.259-1.54c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486
          c0.003-0.182,0.172-0.362,0.263-0.542c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792
          c0,2.991,0.002,5.981-0.002,8.972c-0.001,0.559,0.166,1.09,0.712,1.237c0.399,0.108,0.988,0.084,1.283-0.148
          c0.304-0.239,0.493-0.8,0.496-1.222c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265
          c0.056-0.144,0.146-0.275,0.221-0.412c0.085,0.126,0.219,0.243,0.243,0.379C27.026,12.94,27,13.191,27,13.436
          c-0.001,1.696-0.008,3.392,0,5.089c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217
          C28.993,15.851,28.996,13.151,28.988,10.451z" />
            <path d="M23.776,3.5C22.667,3.5,21.762,4.399,21.77,5.492c0.007,1.07,0.888,1.951,1.961,1.963c1.136,0.012,2.019-0.837,2.027-1.95
          C25.767,4.394,24.882,3.499,23.776,3.5z" />
            <path d="M44.464,10.451c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003
          c-1.463,0.005-2.229,0.771-2.233,2.228c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142
          c0.025,0.585,0.445,0.966,0.988,0.967c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536
          c0-1.83-0.005-3.66,0.01-5.49c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484
          c0.044,0.118,0.009,0.265,0.009,0.399c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529
          c0.804,0.016,1.256-0.528,1.259-1.54c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486
          c0.003-0.182,0.172-0.362,0.263-0.542c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792
          c0,2.991,0.002,5.981-0.002,8.972c-0.001,0.559,0.166,1.09,0.711,1.237c0.399,0.108,0.988,0.084,1.283-0.148
          c0.304-0.239,0.493-0.8,0.496-1.222c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265
          c0.056-0.144,0.146-0.275,0.221-0.412c0.084,0.126,0.219,0.243,0.242,0.379c0.041,0.239,0.016,0.489,0.015,0.734
          c-0.001,1.696-0.008,3.392,0,5.089c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217
          C44.469,15.851,44.473,13.151,44.464,10.451z" />
            <path d="M39.252,3.5c-1.109,0.001-2.013,0.899-2.006,1.993c0.007,1.07,0.888,1.951,1.961,1.963c1.136,0.012,2.019-0.837,2.027-1.95
          C41.243,4.394,40.358,3.499,39.252,3.5z" />
            <path d="M48.531,10.569c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142c0.025,0.585,0.445,0.966,0.988,0.967
          c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536c0-1.83-0.005-3.66,0.01-5.49
          c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484c0.044,0.118,0.009,0.265,0.009,0.399
          c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529c0.804,0.016,1.256-0.528,1.259-1.54
          c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486c0.003-0.182,0.172-0.362,0.263-0.542
          c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792c0,2.991,0.002,5.981-0.002,8.972
          c-0.001,0.559,0.166,1.09,0.712,1.237c0.399,0.108,0.988,0.084,1.283-0.148c0.304-0.239,0.493-0.8,0.496-1.222
          c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265c0.056-0.144,0.146-0.275,0.221-0.412
          c0.085,0.126,0.219,0.243,0.243,0.379C57.026,12.94,57,13.191,57,13.436c-0.001,1.696-0.008,3.392,0,5.089
          c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217c0.003-2.7,0.007-5.401-0.002-8.101
          c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003C49.301,8.345,48.535,9.112,48.531,10.569z" />
            <path d="M55.758,5.505c0.008-1.112-0.877-2.007-1.983-2.006C52.667,3.5,51.762,4.399,51.77,5.492
          c0.007,1.07,0.888,1.951,1.961,1.963C54.867,7.468,55.75,6.618,55.758,5.505z" />
            <path d="M5.005,49.771c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536c0-1.83-0.005-3.66,0.01-5.49
          c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484c0.044,0.118,0.009,0.265,0.009,0.399
          c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529c0.804,0.016,1.256-0.528,1.259-1.54
          c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486c0.003-0.182,0.172-0.362,0.263-0.542
          c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792c0,2.991,0.002,5.981-0.002,8.972
          c-0.001,0.559,0.166,1.09,0.711,1.237c0.399,0.108,0.988,0.084,1.283-0.148c0.304-0.239,0.493-0.8,0.496-1.222
          c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265c0.056-0.144,0.146-0.275,0.221-0.412
          c0.084,0.126,0.219,0.243,0.242,0.379c0.041,0.239,0.016,0.489,0.015,0.734c-0.001,1.696-0.008,3.392,0,5.089
          c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217c0.003-2.7,0.007-5.401-0.002-8.101
          c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003c-1.463,0.005-2.229,0.771-2.233,2.228
          c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142C4.041,49.389,4.462,49.769,5.005,49.771z" />
            <path d="M7.246,35.492c0.007,1.07,0.888,1.951,1.961,1.963c1.136,0.012,2.019-0.837,2.027-1.95
          c0.008-1.112-0.877-2.007-1.983-2.006C8.144,33.5,7.239,34.399,7.246,35.492z" />
            <path d="M27,48.525c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217c0.003-2.7,0.007-5.401-0.002-8.101
          c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003c-1.463,0.005-2.229,0.771-2.233,2.228
          c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142c0.025,0.585,0.445,0.966,0.988,0.967
          c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536c0-1.83-0.005-3.66,0.01-5.49
          c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484c0.044,0.118,0.009,0.265,0.009,0.399
          c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529c0.804,0.016,1.256-0.528,1.259-1.54
          c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486c0.003-0.182,0.172-0.362,0.263-0.542
          c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792c0,2.991,0.002,5.981-0.002,8.972
          c-0.001,0.559,0.166,1.09,0.712,1.237c0.399,0.108,0.988,0.084,1.283-0.148c0.304-0.239,0.493-0.8,0.496-1.222
          c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265c0.056-0.144,0.146-0.275,0.221-0.412
          c0.085,0.126,0.219,0.243,0.243,0.379C27.026,42.94,27,43.191,27,43.436C26.999,45.132,26.992,46.828,27,48.525z" />
            <path d="M25.758,35.505c0.008-1.112-0.877-2.007-1.983-2.006c-1.109,0.001-2.013,0.899-2.006,1.993
          c0.007,1.07,0.888,1.951,1.961,1.963C24.867,37.468,25.75,36.618,25.758,35.505z" />
            <path d="M42.476,48.525c0.004,0.807,0.36,1.237,0.993,1.244c0.651,0.008,0.996-0.404,0.997-1.217
          c0.003-2.7,0.007-5.401-0.002-8.101c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003
          c-1.463,0.005-2.229,0.771-2.233,2.228c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142
          c0.025,0.585,0.445,0.966,0.988,0.967c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536
          c0-1.83-0.005-3.66,0.01-5.49c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484
          c0.044,0.118,0.009,0.265,0.009,0.399c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529
          c0.804,0.016,1.256-0.528,1.259-1.54c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486
          c0.003-0.182,0.172-0.362,0.263-0.542c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792
          c0,2.991,0.002,5.981-0.002,8.972c-0.001,0.559,0.166,1.09,0.711,1.237c0.399,0.108,0.988,0.084,1.283-0.148
          c0.304-0.239,0.493-0.8,0.496-1.222c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265
          c0.056-0.144,0.146-0.275,0.221-0.412c0.084,0.126,0.219,0.243,0.242,0.379c0.041,0.239,0.016,0.489,0.015,0.734
          C42.476,45.132,42.469,46.828,42.476,48.525z" />
            <path d="M41.235,35.505c0.008-1.112-0.877-2.007-1.983-2.006c-1.109,0.001-2.013,0.899-2.006,1.993
          c0.007,1.07,0.888,1.951,1.961,1.963C40.344,37.468,41.227,36.618,41.235,35.505z" />
            <path d="M58.99,48.552c0.003-2.7,0.007-5.401-0.002-8.101c-0.004-1.338-0.777-2.1-2.131-2.107c-2.031-0.01-4.061-0.009-6.092-0.003
          c-1.463,0.005-2.229,0.771-2.233,2.228c-0.005,2.031-0.002,4.062-0.001,6.093c0,0.714-0.021,1.429,0.01,2.142
          c0.025,0.585,0.445,0.966,0.988,0.967c0.55,0.001,0.948-0.375,0.998-0.957c0.015-0.177,0.005-0.357,0.005-0.536
          c0-1.83-0.005-3.66,0.01-5.49c0.001-0.157,0.138-0.313,0.211-0.47c0.097,0.16,0.218,0.311,0.282,0.484
          c0.044,0.118,0.009,0.265,0.009,0.399c0,5.423-0.001,10.846,0,16.27c0,0.956,0.445,1.514,1.204,1.529
          c0.804,0.016,1.256-0.528,1.259-1.54c0.005-1.562,0.001-3.125,0.001-4.687c0-1.495-0.01-2.991,0.012-4.486
          c0.003-0.182,0.172-0.362,0.263-0.542c0.078,0.032,0.157,0.063,0.235,0.095c0,0.264,0,0.528,0,0.792
          c0,2.991,0.002,5.981-0.002,8.972c-0.001,0.559,0.166,1.09,0.712,1.237c0.399,0.108,0.988,0.084,1.283-0.148
          c0.304-0.239,0.493-0.8,0.496-1.222c0.031-5.49,0.02-10.98,0.018-16.47c0-0.089-0.033-0.189-0.004-0.265
          c0.056-0.144,0.146-0.275,0.221-0.412c0.085,0.126,0.219,0.243,0.243,0.379C57.026,42.94,57,43.191,57,43.436
          c-0.001,1.696-0.008,3.392,0,5.089c0.004,0.807,0.36,1.237,0.993,1.244C58.644,49.777,58.989,49.365,58.99,48.552z" />
            <path d="M55.758,35.505c0.008-1.112-0.877-2.007-1.983-2.006c-1.109,0.001-2.013,0.899-2.006,1.993
          c0.007,1.07,0.888,1.951,1.961,1.963C54.867,37.468,55.75,36.618,55.758,35.505z" />
          </g>
        </g>
      </svg>
</div>

</body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="scripts/libraries/slider.js"></script>
<script src="scripts/libraries/sticker.js"></script>
<script src="scripts/libraries/dimple.js"></script>
<script type="text/javascript">

// DATA
    var data = [{
      "date": 1991,
      "Housing Units": 345630,
      "Employment": 558990,
      "Population": 729.708
    }, {
      "date": 1992,
      "Housing Units": 346355,
      "Employment": 545721,
      "Population": 734.861
    }, {
      "date": 1993,
      "Housing Units": 346643,
      "Employment": 549716,
      "Population": 740.277
    }, {
      "date": 1994,
      "Housing Units": 347829,
      "Employment": 573011,
      "Population": 742.316
    }, {
      "date": 1995,
      "Housing Units": 348230,
      "Employment": 556401,
      "Population": 746.386
    }, {
      "date": 1996,
      "Housing Units": 348913,
      "Employment": 536304,
      "Population": 753.934
    }, {
      "date": 1997,
      "Housing Units": 349638,
      "Employment": 524940,
      "Population": 762.953
    }, {
      "date": 1998,
      "Housing Units": 350512,
      "Employment": 520434,
      "Population": 770.262
    }, {
      "date": 1999,
      "Housing Units": 351797,
      "Employment": 532908,
      "Population": 774.716
    }, {
      "date": 2000,
      "Housing Units": 353594,
      "Employment": 547304,
      "Population": 777.340
    }, {
      "date": 2001,
      "Housing Units": 355373,
      "Employment": 586085,
      "Population": 784.677
    }, {
      "date": 2002,
      "Housing Units": 357781,
      "Employment": 611676,
      "Population": 779.447
    }, {
      "date": 2003,
      "Housing Units": 360277,
      "Employment": 591192,
      "Population": 775.663
    }, {
      "date": 2004,
      "Housing Units": 361764,
      "Employment": 575340,
      "Population": 773.556
    }, {
      "date": 2005,
      "Housing Units": 363619,
      "Employment": 554574,
      "Population": 777.835
    }, {
      "date": 2006,
      "Housing Units": 365533,
      "Employment": 542721,
      "Population": 786.187
    }, {
      "date": 2007,
      "Housing Units": 368100,
      "Employment": 528833,
      "Population": 799.185
    }, {
      "date": 2008,
      "Housing Units": 371363,
      "Employment": 525870,
      "Population": 807.904
    }, {
      "date": 2009,
      "Housing Units": 374817,
      "Employment": 531539,
      "Population": 815.184
    }, {
      "date": 2010,
      "Housing Units": 376047,
      "Employment": 536833,
      "Population": 805.607
    }, {
      "date": 2011,
      "Housing Units": 376316,
      "Employment": 571191,
      "Population": 814.233
    }];


var div = d3.select("body").append("div")
  .attr("class", "tooltip")
  .style("opacity", 0);

var margin = {
  top: 40,
  right: 120,
  bottom: 30,
  left: 50
},
  width = 620 - margin.left - margin.right,
  height = 450 - margin.top - margin.bottom;

var parseDate = d3.time.format("%Y").parse;

var formatTime = d3.time.format("%Y");

var format = d3.format("s");

var format2 = d3.format(",g")

var x = d3.time.scale()
  .range([0, width]);

var y = d3.scale.linear()
  .range([height, 0]);

var color = d3.scale.ordinal()
  .range(["#d39651", "#80b1d3", "#fb8072"]);

var xAxis = d3.svg.axis()
  .scale(x)
  .orient("bottom")

var yAxis = d3.svg.axis()
  .scale(y)
  .orient("left")
  .tickFormat(format)
  .tickSize(-width, 0, 0)

var line = d3.svg.line()
// .interpolate("basis")
.x(function(d) {
  return x(d.date);
})
  .y(function(d) {
    return y(d[which]);
  });

var which = "change";

var bigYear = 1992;

var svg = d3.select("#chartContainer1").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

color.domain(d3.keys(data[0]).filter(function(key) {
  return key !== "date";
}));

data.forEach(function(d) {
  d.date = parseDate(new String(d.date));
  d.Population = +d.Population * 1000
});




var metrics = color.domain().map(function(name) {
  return {
    name: name,
    values: data.map(function(d, i) {
      return {
        date: d.date,
        abs: +d[name],
      };
    })
  };
});

metrics.forEach(function(name) {
  var f = name.values
  f.forEach(function(d, i) {
    d.change = d.abs - f[0].abs;
  });
});

x.domain(d3.extent(data, function(d) {
  return d.date;
}));

y.domain([
  d3.min(metrics, function(c) {
    return d3.min(c.values, function(v) {
      return v[which];
    });
  }),
  d3.max(metrics, function(c) {
    return d3.max(c.values, function(v) {
      return v[which];
    });
  })
]);

svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(xAxis);

var gYAxis = svg.append("g")
  .attr("class", "y axis")
  .call(yAxis)


var bisect = d3.bisector(function(d) {
  return d.date;
}).right;

var metric = svg.selectAll(".metric")
  .data(metrics)
  .enter().append("g")
  .attr("class", "metric");

metric.append("path")
  .attr("class", "line")
  .attr("stroke-width", "1.5px")
  .attr("d", function(d) {
    return line(d.values);
  })
  .style("stroke", function(d) {
    return color(d.name);
  });

var metricsInvisible = metric.append("path")
  .attr("class", "line metrics-invisible")
  .attr("d", function(d) {
    return line(d.values);
  })
  .attr("stroke-width", "40px")
  .attr("opacity", 0)

var labels = metric.append("text")
  .datum(function(d) {
    return {
      name: d.name,
      value: d.values[d.values.length - 1]
    };
  })
  .attr("transform", function(d) {
    return "translate(" + x(d.value.date) + "," + y(d.value[which]) + ")";
  })
  .attr("x", "-1.5em")
  .attr("dy", "-.35em")
  .text(function(d) {
    return d.name;
  });

var units = {
  "Housing Units": "units",
  "Employment": "jobs",
  "Population": "persons"
}

metricsInvisible
  .on('mousemove', function(d) {

    var year = d3.time.year.round(x.invert(d3.mouse(this)[0])).getFullYear();

    var c = d.values.filter(function(v) {
      return v.date.getFullYear() == year;
    })[0];

    slide(null, year);

    var top = (y(c[which]) - 25);

    top = (top < 100) ? (y(c[which]) + 75) : top

    var l = (x(c.date) - 10);

    l = (l < 100) ? (x(c.date) + 45) : l

    l = (l>(width-100)) ? (l-85) : l

    div.transition()
      .duration(100)
      .style("opacity", .8);
    div.html( "<span>" + d.name +  "</span></br>" + "Year: " + formatTime(c.date) + "<br/>" + "&Delta;: " + format2(c.change) + " " + units[d.name] + "<br/>" + "Total: " + format2(c.abs) + " " + units[d.name])
      .style("background",function(){ return d3.rgb(color(d.name)).darker(.5); })
      .style("left", l + "px")
      .style("top", top + "px");

  })
  .on("mouseout", function(d) {
    div.transition()
      .duration(500)
      .style("opacity", 0);
  });

function adapt() {

  which = (which == "abs") ? "change" : "abs"

  d3.select("button").html(function(d) {
    return (which == "abs") ? "Absolute Levels" : "Change Since 1991"
  });


  y.domain([
    d3.min(metrics, function(c) {
      return d3.min(c.values, function(v) {
        return v[which];
      });
    }),
    d3.max(metrics, function(c) {
      return d3.max(c.values, function(v) {
        return v[which];
      });
    })
  ]);

  scale.domain([d3.min([y.domain()[0],0]),y.domain()[1]]);

  gYAxis.transition().duration(250).call(yAxis);

  labels
    .transition()
    .duration(500)
    .attr("transform", function(d) {
      return "translate(" + x(d.value.date) + "," + y(d.value[which]) + ")";
    });

  metric.select("path").transition().duration(500).attr("d", function(d) {
    return line(d.values);
  });

  metricsInvisible.transition().duration(500).attr("d", function(d) {
    return line(d.values);
  });

  balls
    .transition()
    .duration(500)
    .attr({
      transform: function(v) {
        var t = v.values.filter(function(d){ return d.date.getFullYear() == bigYear; })[0];
        return "translate(" + [x(t.date), y(t[which])] + ")";
      }
    });

} //end adapt()

balls = metric
  .append("g")
  .attr("class","ball");

balls.append("circle")
  .attr({
    r: 5,
    fill: function(d){
      return color(d.name)
    },
  })
  .style("pointer-events", "none");

d3.select("#slider")
  .style({
    width: 505 + "px",
    "margin-top": 5 + "px",
    "margin-left": 70 + "px",
  });

var sliderCall = d3.slider().max(2011).min(1991).step(1).on("slide", slide);

d3.select('#slider').call(sliderCall);

var svg2 = d3.select("#icons").append("svg")
  .attr("width", 620)
  .attr("height", 100);

  var scale = d3.scale.linear().domain(y.domain()).range([.3, 2]);

  var iconsG = svg2.append("g").attr("transform", "translate(" + [120, 50] + ")");
  var iconsNames = ["#house", "#worker", "#people" ];

  var icons = iconsG.selectAll("icons").data(metrics).enter().append("g").attr("class","overG")
    .attr("transform",function(d,i){
      return "translate(" + [i*170,0] + ")";
    });


  icons.append("g")
    .attr("class","underG")
    .each(function(d,i){
      return d3.sticker(iconsNames[i])(d3.select(this));
    });


  icons.selectAll(".underG").attr({
    transform: function(d){
      return "scale(" + scale(d.values[0][which]) + ")";
    },
  });

// var scale = d3.scale.sqrt().domain(y.domain()).range([.3, 2]);

// var iconsG = svg2.append("g").attr("transform", "translate(" + [120, 50] + ")");

// var iconsNames = ["#house", "#worker", "#people" ];

// var icons = iconsG.selectAll("icons").data(metrics).enter().append("g").attr("class","overG")
//   .attr("transform",function(d,i){
//     return "translate(" + [i*170,0] + ")";
//   });

// var icons2 = iconsG.selectAll("icons").data(metrics).enter().append("g").attr("class","overG")
//   .attr("transform",function(d,i){
//     return "translate(" + [i*170,0] + ")";
//   })
//   .append("g")
//     .attr("class","underGB")
//     .each(function(d,i){
//       return d3.sticker(iconsNames[i])(d3.select(this));
//     })

// var clips = icons.append("defs").append("svg:clipPath")
//     .attr("id", function(d,i){
//       return "clip" + i;
//     });

// var recs = clips.append("svg:rect")
//     .attr("id", "clip-rect")
//     .attr("y", 0)
//     .attr("width", 45)
//     .attr("height", 45);

// var shapes = icons2.append("g")
//   .attr("class","underG")
//   .attr("clip-path", function(d,i){
//     return "url(#clip" + i + ")"
//   })
//   .each(function(d,i){
//     return d3.sticker(iconsNames[i])(d3.select(this));
//   })

//   shapes.attr("fill",function(d){
//     return color(d.name);
//   })

// // shapes.attr("fill","#333")

function slide(event, year) {

  bigYear = year

  balls
    .attr({
      transform: function(v) {
        var t = v.values.filter(function(d){ return d.date.getFullYear() == year; })[0];
        return "translate(" + [x(t.date), y(t[which])] + ")";
      }
    });


  icons.selectAll(".underG").attr({
    transform: function(v){
     var t = v.values.filter(function(d){ return d.date.getFullYear() == year; })[0];
      return "scale(" + scale(t[which]) + ")";
    }
  });

    // recs.each(function(v){
    //     var t = v.values.filter(function(d){ return d.date.getFullYear() == year; })[0];
    //     console.log(t)
    //     d3.select(this).attr({
    //       height: 100 - y2(t[which]),
    //       y: y2(t[which])
    //     })
    //   });
    //   // .attr("height", function(d){
      // var t = v.values.filter(function(d){ return d.date.getFullYear() == year; })[0];
      //  return 100 - y(val) 
      // })
      // .attr("y", y(val))

 // icons.selectAll(".underG").attr({
 //   transform: function(v){
 //    var t = v.values.filter(function(d){ return d.date.getFullYear() == year; })[0];
 //     return "scale(" + scale(t[which]) + ")";
 //   }
 // });



};
</script>
